<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Анхны тоонуудын нийлбэр</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      h2 {
        color: #333;
      }
      #result {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f9f9f9;
      }
      button {
        margin-top: 10px;
        padding: 8px 16px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      input {
        padding: 8px;
        width: 200px;
      }
    </style>
  </head>
  <body>
    <h2>Анхны тоонуудын нийлбэрт задлах</h2>
    <div>
      <input
        type="number"
        id="numberInput"
        min="2"
        max="1000000"
        placeholder="2-1000000 хүртэлх тоо"
      />
      <button onclick="decomposeNumber()">Задлах</button>
    </div>
    <p id="result">Үр дүн энд гарна...</p>

    <script>
      // Sieve алгоритм - хурдан анхны тоо гаргана
      function getAllPrimes(limit) {
        const sieve = new Array(limit + 1).fill(true);
        sieve[0] = sieve[1] = false;
        for (let i = 2; i * i <= limit; i++) {
          if (sieve[i]) {
            for (let j = i * i; j <= limit; j += i) {
              sieve[j] = false;
            }
          }
        }
        const primes = [];
        for (let i = 2; i <= limit; i++) {
          if (sieve[i]) primes.push(i);
        }
        return primes;
      }

      // Гольдбахын таамаглал - 2-оос их бүх тэгш тоо 2 анхны тооны нийлбэр
      function findGoldbachPair(n, primes) {
        for (let i = 0; i < primes.length; i++) {
          const diff = n - primes[i];
          if (primes.includes(diff)) {
            return [primes[i], diff];
          }
        }
        return null;
      }

      // Тоог анхны тоонуудын нийлбэрт задлах функц
      function findPrimeSum(target, primes) {
        // Хэрэв тоо өөрөө анхны тоо бол
        if (primes.includes(target)) {
          return [target];
        }

        // Тэгш тоо бол Гольдбахын таамаглалыг ашиглах
        if (target % 2 === 0 && target > 2) {
          const pair = findGoldbachPair(target, primes);
          if (pair) return pair;
        }

        // 2-ийг оруулах - хамгийн сайн арга нь ихэнх тохиолдолд
        if (target > 2) {
          const result = findPrimeSum(target - 2, primes);
          if (result) {
            return [2, ...result];
          }
        }

        // Өөр бүх анхны тоонуудыг шалгах
        for (let i = 0; i < primes.length && primes[i] < target; i++) {
          const rest = target - primes[i];
          if (rest >= 2) {
            const result = findPrimeSum(rest, primes);
            if (result) {
              return [primes[i], ...result];
            }
          }
        }

        return null; // Шийдэл олдсонгүй
      }

      // Рекурсив арга хэтэрхий гүн болохоос сэргийлэх шийдэл
      function decomposeAsPrimeSum(target, primes) {
        // Анхны тоо өөрөө бол яг тэр
        if (primes.includes(target)) {
          return [target];
        }

        // Бага тоонуудад энгийн шийдэл хэрэглэе
        if (target <= 100) {
          return findPrimeSum(
            target,
            primes.filter((p) => p <= target)
          );
        }

        // Том тоонуудад илүү практик шийдэл
        // Өөрт нь хамгийн ойр байх анхны тоог олж,
        // Үлдсэн зөрүүг дахин задлах
        const closestPrime = [...primes].reverse().find((p) => p <= target);
        if (!closestPrime) return null;

        const remainder = target - closestPrime;
        if (remainder === 0) return [closestPrime];

        const restDecomposition = decomposeAsPrimeSum(remainder, primes);
        if (restDecomposition) {
          return [closestPrime, ...restDecomposition];
        }

        // Хэрэв хамгийн их анхны тоогоор эхэлбэл бүтэлгүйтвэл
        // 2-оор эхэлье (ихэнх тоонд ажилладаг)
        if (target > 2) {
          const restDecomposition = decomposeAsPrimeSum(target - 2, primes);
          if (restDecomposition) {
            return [2, ...restDecomposition];
          }
        }

        return null;
      }

      function decomposeNumber() {
        const input = document.getElementById("numberInput").value;
        const target = parseInt(input);
        const resultElement = document.getElementById("result");

        if (isNaN(target) || target < 2 || target > 1000000) {
          resultElement.innerText =
            "2-оос 1,000,000 хүртэлх бүхэл тоо оруулна уу.";
          return;
        }

        // Хангалттай том хязгаар тавьж анхны тоонуудыг хайх
        const limit = Math.min(target, 10000);
        const primes = getAllPrimes(limit);

        // Тоог задлах
        const decomposition = decomposeAsPrimeSum(target, primes);

        if (decomposition) {
          resultElement.innerText = target + " = " + decomposition.join(" + ");
        } else {
          resultElement.innerText =
            "Задлаж чадсангүй. Бүх анхны тоо хүрэлцээгүй байж магадгүй.";
        }
      }

      // Хуудас ачааллахад нэг удаа гүйцэтгэх
      window.onload = function () {
        // Анхны утга (заавал биш)
        const inputElement = document.getElementById("numberInput");
        if (inputElement) {
          inputElement.value = "";
        }
      };
    </script>
  </body>
</html>
